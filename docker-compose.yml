version: '3.8'

services:
  scraper-wb:
    build:
      context: ./extract/wb
      dockerfile: Dockerfile
    container_name: scraper_wb_cpi
    environment:
      - PYTHONUNBUFFERED=1
    # Uncomment to override default command
    # command: python scraper.py

  scraper-oecd:
    build:
      context: ./extract/oecd
      dockerfile: Dockerfile
    container_name: scraper_oecd_wages
    environment:
      - PYTHONUNBUFFERED=1
    # Uncomment to override default command
    # command: python scraper.py

  scraper-faostat:
    build:
      context: ./extract/faostat
      dockerfile: Dockerfile
    container_name: scraper_faostat_food_cpi
    environment:
      - PYTHONUNBUFFERED=1
    # Uncomment to override default command
    # command: python scraper.py

  scraper-ilostat:
    build:
      context: ./extract/ilostat
      dockerfile: Dockerfile
    container_name: scraper_ilostat_wages
    environment:
      - PYTHONUNBUFFERED=1
    # Uncomment to override default command
    # command: python scraper.py

  mongo:
    image: mongo:7
    container_name: diploma_mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
      - ./load/init_mongo.js:/docker-entrypoint-initdb.d/init_mongo.js:ro

  spark:
    build:
      context: .
      dockerfile: transform/Dockerfile
    container_name: diploma_spark_etl
    depends_on:
      - mongo
    environment:
      - PYTHONUNBUFFERED=1
      - MONGO_URI=mongodb://mongo:27017
      - MONGO_DB=diploma
    volumes:
      - ./extract:/app/extract
      - ./transform:/app/transform

volumes:
  mongo_data:
